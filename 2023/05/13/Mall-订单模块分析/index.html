<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Mall 订单模块分析 - Hexo</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="MoonlightQz"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="MoonlightQz"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="订单管理分析数据库表总览  订单管理表格订单详情表123456789101112131415161718192021222324252627282930313233343536373839404142434445464748create table oms_order(   id                   bigint not null auto_increment comment &amp;amp;#"><meta property="og:type" content="blog"><meta property="og:title" content="Mall 订单模块分析"><meta property="og:url" content="http://example.com/2023/05/13/Mall-%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90/"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="订单管理分析数据库表总览  订单管理表格订单详情表123456789101112131415161718192021222324252627282930313233343536373839404142434445464748create table oms_order(   id                   bigint not null auto_increment comment &amp;amp;#"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132139025.jpg"><meta property="og:image" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132139060.jpeg"><meta property="og:image" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132146351.png"><meta property="og:image" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132146851.png"><meta property="og:image" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132148816.png"><meta property="og:image" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140932747.png"><meta property="og:image" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140932252.png"><meta property="og:image" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140932971.png"><meta property="og:image" content="https://www.macrozheng.com/assets/database_screen_47.1e1c65a1.png"><meta property="og:image" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140938045.png"><meta property="og:image" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140938549.png"><meta property="og:image" content="https://www.macrozheng.com/assets/database_screen_51.45f85b48.jpg"><meta property="og:image" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305141042159.jpg"><meta property="article:published_time" content="2023-05-13T13:37:17.000Z"><meta property="article:modified_time" content="2023-05-24T01:49:47.818Z"><meta property="article:author" content="MoonlightQz"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132139025.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2023/05/13/Mall-%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90/"},"headline":"Mall 订单模块分析","image":["https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132139025.jpg","https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132146351.png","https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132146851.png","https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132148816.png","https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140932747.png","https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140932252.png","https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140932971.png","https://www.macrozheng.com/assets/database_screen_47.1e1c65a1.png","https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140938045.png","https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140938549.png","https://www.macrozheng.com/assets/database_screen_51.45f85b48.jpg","https://gitee.com/moonlightqz/PicGo/raw/master/img/202305141042159.jpg"],"datePublished":"2023-05-13T13:37:17.000Z","dateModified":"2023-05-24T01:49:47.818Z","author":{"@type":"Person","name":"MoonlightQz"},"publisher":{"@type":"Organization","name":"Hexo","logo":{"@type":"ImageObject","url":"http://example.com/img/logo.svg"}},"description":"订单管理分析数据库表总览  订单管理表格订单详情表123456789101112131415161718192021222324252627282930313233343536373839404142434445464748create table oms_order(   id                   bigint not null auto_increment comment &amp;#"}</script><link rel="canonical" href="http://example.com/2023/05/13/Mall-%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-13T13:37:17.000Z" title="2023/5/13 21:37:17">2023-05-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-05-24T01:49:47.818Z" title="2023/5/24 09:49:47">2023-05-24</time></span><span class="level-item">21 minutes read (About 3106 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Mall 订单模块分析</h1><div class="content"><h2 id="订单管理分析"><a href="#订单管理分析" class="headerlink" title="订单管理分析"></a>订单管理分析</h2><h3 id="数据库表总览"><a href="#数据库表总览" class="headerlink" title="数据库表总览"></a>数据库表总览</h3><p><img src="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132139025.jpg" alt="img"></p>
<p><img src="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132139060.jpeg" alt="img"></p>
<h3 id="订单管理"><a href="#订单管理" class="headerlink" title="订单管理"></a>订单管理</h3><h4 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h4><h5 id="订单详情表"><a href="#订单详情表" class="headerlink" title="订单详情表"></a>订单详情表</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> oms_order</span><br><span class="line">(</span><br><span class="line">   id                   <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment comment <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">   member_id            <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;会员id&#x27;</span>,</span><br><span class="line">   coupon_id            <span class="type">bigint</span> comment <span class="string">&#x27;优惠券id&#x27;</span>,</span><br><span class="line">   order_sn             <span class="type">varchar</span>(<span class="number">64</span>) comment <span class="string">&#x27;订单编号&#x27;</span>,</span><br><span class="line">   create_time          datetime comment <span class="string">&#x27;提交时间&#x27;</span>,</span><br><span class="line">   member_username      <span class="type">varchar</span>(<span class="number">64</span>) comment <span class="string">&#x27;用户帐号&#x27;</span>,</span><br><span class="line">   total_amount         <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;订单总金额&#x27;</span>,</span><br><span class="line">   pay_amount           <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;应付金额（实际支付金额）&#x27;</span>,</span><br><span class="line">   freight_amount       <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;运费金额&#x27;</span>,</span><br><span class="line">   promotion_amount     <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;促销优化金额（促销价、满减、阶梯价）&#x27;</span>,</span><br><span class="line">   integration_amount   <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;积分抵扣金额&#x27;</span>,</span><br><span class="line">   coupon_amount        <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;优惠券抵扣金额&#x27;</span>,</span><br><span class="line">   discount_amount      <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;管理员后台调整订单使用的折扣金额&#x27;</span>,</span><br><span class="line">   pay_type             <span class="type">int</span>(<span class="number">1</span>) comment <span class="string">&#x27;支付方式：0-&gt;未支付；1-&gt;支付宝；2-&gt;微信&#x27;</span>,</span><br><span class="line">   source_type          <span class="type">int</span>(<span class="number">1</span>) comment <span class="string">&#x27;订单来源：0-&gt;PC订单；1-&gt;app订单&#x27;</span>,</span><br><span class="line">   status               <span class="type">int</span>(<span class="number">1</span>) comment <span class="string">&#x27;订单状态：0-&gt;待付款；1-&gt;待发货；2-&gt;已发货；3-&gt;已完成；4-&gt;已关闭；5-&gt;无效订单&#x27;</span>,</span><br><span class="line">   order_type           <span class="type">int</span>(<span class="number">1</span>) comment <span class="string">&#x27;订单类型：0-&gt;正常订单；1-&gt;秒杀订单&#x27;</span>,</span><br><span class="line">   delivery_company     <span class="type">varchar</span>(<span class="number">64</span>) comment <span class="string">&#x27;物流公司(配送方式)&#x27;</span>,</span><br><span class="line">   delivery_sn          <span class="type">varchar</span>(<span class="number">64</span>) comment <span class="string">&#x27;物流单号&#x27;</span>,</span><br><span class="line">   auto_confirm_day     <span class="type">int</span> comment <span class="string">&#x27;自动确认时间（天）&#x27;</span>,</span><br><span class="line">   integration          <span class="type">int</span> comment <span class="string">&#x27;可以获得的积分&#x27;</span>,</span><br><span class="line">   growth               <span class="type">int</span> comment <span class="string">&#x27;可以活动的成长值&#x27;</span>,</span><br><span class="line">   promotion_info       <span class="type">varchar</span>(<span class="number">100</span>) comment <span class="string">&#x27;活动信息&#x27;</span>,</span><br><span class="line">   bill_type            <span class="type">int</span>(<span class="number">1</span>) comment <span class="string">&#x27;发票类型：0-&gt;不开发票；1-&gt;电子发票；2-&gt;纸质发票&#x27;</span>,</span><br><span class="line">   bill_header          <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;发票抬头&#x27;</span>,</span><br><span class="line">   bill_content         <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;发票内容&#x27;</span>,</span><br><span class="line">   bill_receiver_phone  <span class="type">varchar</span>(<span class="number">32</span>) comment <span class="string">&#x27;收票人电话&#x27;</span>,</span><br><span class="line">   bill_receiver_email  <span class="type">varchar</span>(<span class="number">64</span>) comment <span class="string">&#x27;收票人邮箱&#x27;</span>,</span><br><span class="line">   receiver_name        <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;收货人姓名&#x27;</span>,</span><br><span class="line">   receiver_phone       <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;收货人电话&#x27;</span>,</span><br><span class="line">   receiver_post_code   <span class="type">varchar</span>(<span class="number">32</span>) comment <span class="string">&#x27;收货人邮编&#x27;</span>,</span><br><span class="line">   receiver_province    <span class="type">varchar</span>(<span class="number">32</span>) comment <span class="string">&#x27;省份/直辖市&#x27;</span>,</span><br><span class="line">   receiver_city        <span class="type">varchar</span>(<span class="number">32</span>) comment <span class="string">&#x27;城市&#x27;</span>,</span><br><span class="line">   receiver_region      <span class="type">varchar</span>(<span class="number">32</span>) comment <span class="string">&#x27;区&#x27;</span>,</span><br><span class="line">   receiver_detail_address <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;详细地址&#x27;</span>,</span><br><span class="line">   note                 <span class="type">varchar</span>(<span class="number">500</span>) comment <span class="string">&#x27;订单备注&#x27;</span>,</span><br><span class="line">   confirm_status       <span class="type">int</span>(<span class="number">1</span>) comment <span class="string">&#x27;确认收货状态：0-&gt;未确认；1-&gt;已确认&#x27;</span>,</span><br><span class="line">   delete_status        <span class="type">int</span>(<span class="number">1</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;删除状态：0-&gt;未删除；1-&gt;已删除&#x27;</span>,</span><br><span class="line">   use_integration      <span class="type">int</span> comment <span class="string">&#x27;下单时使用的积分&#x27;</span>,</span><br><span class="line">   payment_time         datetime comment <span class="string">&#x27;支付时间&#x27;</span>,</span><br><span class="line">   delivery_time        datetime comment <span class="string">&#x27;发货时间&#x27;</span>,</span><br><span class="line">   receive_time         datetime comment <span class="string">&#x27;确认收货时间&#x27;</span>,</span><br><span class="line">   comment_time         datetime comment <span class="string">&#x27;评价时间&#x27;</span>,</span><br><span class="line">   modify_time          datetime comment <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">   <span class="keyword">primary</span> key (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="订单商品表"><a href="#订单商品表" class="headerlink" title="订单商品表"></a>订单商品表</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> oms_order_item</span><br><span class="line">(</span><br><span class="line">   id                   <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">   order_id             <span class="type">bigint</span> comment <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">   order_sn             <span class="type">varchar</span>(<span class="number">64</span>) comment <span class="string">&#x27;订单编号&#x27;</span>,</span><br><span class="line">   product_id           <span class="type">bigint</span> comment <span class="string">&#x27;商品id&#x27;</span>,</span><br><span class="line">   product_pic          <span class="type">varchar</span>(<span class="number">500</span>) comment <span class="string">&#x27;商品图片&#x27;</span>,</span><br><span class="line">   product_name         <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;商品名称&#x27;</span>,</span><br><span class="line">   product_brand        <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;商品品牌&#x27;</span>,</span><br><span class="line">   product_sn           <span class="type">varchar</span>(<span class="number">64</span>) comment <span class="string">&#x27;商品条码&#x27;</span>,</span><br><span class="line">   product_price        <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;销售价格&#x27;</span>,</span><br><span class="line">   product_quantity     <span class="type">int</span> comment <span class="string">&#x27;购买数量&#x27;</span>,</span><br><span class="line">   product_sku_id       <span class="type">bigint</span> comment <span class="string">&#x27;商品sku编号&#x27;</span>,</span><br><span class="line">   product_sku_code     <span class="type">varchar</span>(<span class="number">50</span>) comment <span class="string">&#x27;商品sku条码&#x27;</span>,</span><br><span class="line">   product_category_id  <span class="type">bigint</span> comment <span class="string">&#x27;商品分类id&#x27;</span>,</span><br><span class="line">   sp1                  <span class="type">varchar</span>(<span class="number">100</span>) comment <span class="string">&#x27;商品的销售属性1&#x27;</span>,</span><br><span class="line">   sp2                  <span class="type">varchar</span>(<span class="number">100</span>) comment <span class="string">&#x27;商品的销售属性2&#x27;</span>,</span><br><span class="line">   sp3                  <span class="type">varchar</span>(<span class="number">100</span>) comment <span class="string">&#x27;商品的销售属性3&#x27;</span>,</span><br><span class="line">   promotion_name       <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;商品促销名称&#x27;</span>,</span><br><span class="line">   promotion_amount     <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;商品促销分解金额&#x27;</span>,</span><br><span class="line">   coupon_amount        <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;优惠券优惠分解金额&#x27;</span>,</span><br><span class="line">   integration_amount   <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;积分优惠分解金额&#x27;</span>,</span><br><span class="line">   real_amount          <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;该商品经过优惠后的分解金额&#x27;</span>,</span><br><span class="line">   gift_integration     <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;商品赠送积分&#x27;</span>,</span><br><span class="line">   gift_growth          <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;商品赠送成长值&#x27;</span>,</span><br><span class="line">   product_attr         <span class="type">varchar</span>(<span class="number">500</span>) comment <span class="string">&#x27;商品销售属性:[&#123;&quot;key&quot;:&quot;颜色&quot;,&quot;value&quot;:&quot;颜色&quot;&#125;,&#123;&quot;key&quot;:&quot;容量&quot;,&quot;value&quot;:&quot;4G&quot;&#125;]&#x27;</span>,</span><br><span class="line">   <span class="keyword">primary</span> key (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="订单操作记录表"><a href="#订单操作记录表" class="headerlink" title="订单操作记录表"></a>订单操作记录表</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> oms_order_operate_history</span><br><span class="line">(</span><br><span class="line">   id                   <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">   order_id             <span class="type">bigint</span> comment <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">   operate_man          <span class="type">varchar</span>(<span class="number">100</span>) comment <span class="string">&#x27;操作人：用户；系统；后台管理员&#x27;</span>,</span><br><span class="line">   create_time          datetime comment <span class="string">&#x27;操作时间&#x27;</span>,</span><br><span class="line">   order_status         <span class="type">int</span>(<span class="number">1</span>) comment <span class="string">&#x27;订单状态：0-&gt;待付款；1-&gt;待发货；2-&gt;已发货；3-&gt;已完成；4-&gt;已关闭；5-&gt;无效订单&#x27;</span>,</span><br><span class="line">   note                 <span class="type">varchar</span>(<span class="number">500</span>) comment <span class="string">&#x27;备注&#x27;</span>,</span><br><span class="line">   <span class="keyword">primary</span> key (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="后台"><a href="#后台" class="headerlink" title="后台"></a>后台</h4><h5 id="订单列表"><a href="#订单列表" class="headerlink" title="订单列表"></a>订单列表</h5><p><img src="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132146351.png" alt="image-20230513214616191"></p>
<p><img src="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132146851.png" alt="image-20230513214626580"></p>
<h5 id="订单详情"><a href="#订单详情" class="headerlink" title="订单详情"></a>订单详情</h5><p><img src="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305132148816.png" alt="image-20230513214836888"></p>
<h4 id="业务"><a href="#业务" class="headerlink" title="业务"></a>业务</h4><h5 id="订单列表-1"><a href="#订单列表-1" class="headerlink" title="订单列表"></a>订单列表</h5><h6 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h6><p>后台当然不能直接创建订单，找找创建的接口吧。</p>
<h6 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;批量发货&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/update/delivery&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult delivery(@RequestBody List&lt;OmsOrderDeliveryParam&gt; deliveryParamList) &#123;</span><br><span class="line">    int count = orderService.delivery(deliveryParamList);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;批量关闭订单&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/update/close&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult close(@RequestParam(&quot;ids&quot;) List&lt;Long&gt; ids, @RequestParam String note) &#123;</span><br><span class="line">    int count = orderService.close(ids, note);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;修改收货人信息&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/update/receiverInfo&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult updateReceiverInfo(@RequestBody OmsReceiverInfoParam receiverInfoParam) &#123;</span><br><span class="line">    int count = orderService.updateReceiverInfo(receiverInfoParam);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;修改订单费用信息&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/update/moneyInfo&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult updateReceiverInfo(@RequestBody OmsMoneyInfoParam moneyInfoParam) &#123;</span><br><span class="line">    int count = orderService.updateMoneyInfo(moneyInfoParam);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;备注订单&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/update/note&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult updateNote(@RequestParam(&quot;id&quot;) Long id,</span><br><span class="line">                               @RequestParam(&quot;note&quot;) String note,</span><br><span class="line">                               @RequestParam(&quot;status&quot;) Integer status) &#123;</span><br><span class="line">    int count = orderService.updateNote(id, note, status);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Read-查询订单"><a href="#Read-查询订单" class="headerlink" title="Read 查询订单"></a>Read 查询订单</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;查询订单&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult&lt;CommonPage&lt;OmsOrder&gt;&gt; list(OmsOrderQueryParam queryParam,</span><br><span class="line">                                               @RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;) Integer pageSize,</span><br><span class="line">                                               @RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;) Integer pageNum) &#123;</span><br><span class="line">    List&lt;OmsOrder&gt; orderList = orderService.list(queryParam, pageSize, pageNum);</span><br><span class="line">    return CommonResult.success(CommonPage.restPage(orderList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;获取订单详情：订单信息、商品信息、操作记录&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult&lt;OmsOrderDetail&gt; detail(@PathVariable Long id) &#123;</span><br><span class="line">    OmsOrderDetail orderDetailResult = orderService.detail(id);</span><br><span class="line">    return CommonResult.success(orderDetailResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;批量删除订单&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult delete(@RequestParam(&quot;ids&quot;) List&lt;Long&gt; ids) &#123;</span><br><span class="line">    int count = orderService.delete(ids);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="订单设置"><a href="#订单设置" class="headerlink" title="订单设置"></a>订单设置</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> oms_order_setting</span><br><span class="line">(</span><br><span class="line">   id                   <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">   flash_order_overtime <span class="type">int</span> comment <span class="string">&#x27;秒杀订单超时关闭时间(分)&#x27;</span>,</span><br><span class="line">   normal_order_overtime <span class="type">int</span> comment <span class="string">&#x27;正常订单超时时间(分)&#x27;</span>,</span><br><span class="line">   confirm_overtime     <span class="type">int</span> comment <span class="string">&#x27;发货后自动确认收货时间（天）&#x27;</span>,</span><br><span class="line">   finish_overtime      <span class="type">int</span> comment <span class="string">&#x27;自动完成交易时间，不能申请售后（天）&#x27;</span>,</span><br><span class="line">   comment_overtime     <span class="type">int</span> comment <span class="string">&#x27;订单完成后自动好评时间（天）&#x27;</span>,</span><br><span class="line">   <span class="keyword">primary</span> key (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h6 id="Update-1"><a href="#Update-1" class="headerlink" title="Update"></a>Update</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;修改指定订单设置&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult update(@PathVariable Long id, @RequestBody OmsOrderSetting orderSetting) &#123;</span><br><span class="line">    int count = orderSettingService.update(id,orderSetting);</span><br><span class="line">    if(count&gt;0)&#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;获取指定订单设置&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult&lt;OmsOrderSetting&gt; getItem(@PathVariable Long id) &#123;</span><br><span class="line">    OmsOrderSetting orderSetting = orderSettingService.getItem(id);</span><br><span class="line">    return CommonResult.success(orderSetting);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="退货订单处理"><a href="#退货订单处理" class="headerlink" title="退货订单处理"></a>退货订单处理</h5><h6 id="Update-2"><a href="#Update-2" class="headerlink" title="Update"></a>Update</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;修改退货申请状态&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/update/status/&#123;id&#125;&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult updateStatus(@PathVariable Long id, @RequestBody OmsUpdateStatusParam statusParam) &#123;</span><br><span class="line">    int count = returnApplyService.updateStatus(id, statusParam);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Read-1"><a href="#Read-1" class="headerlink" title="Read"></a>Read</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;分页查询退货申请&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult&lt;CommonPage&lt;OmsOrderReturnApply&gt;&gt; list(OmsReturnApplyQueryParam queryParam,</span><br><span class="line">                                                          @RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;) Integer pageSize,</span><br><span class="line">                                                          @RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;) Integer pageNum) &#123;</span><br><span class="line">    List&lt;OmsOrderReturnApply&gt; returnApplyList = returnApplyService.list(queryParam, pageSize, pageNum);</span><br><span class="line">    return CommonResult.success(CommonPage.restPage(returnApplyList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;获取退货申请详情&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult getItem(@PathVariable Long id) &#123;</span><br><span class="line">    OmsOrderReturnApplyResult result = returnApplyService.getItem(id);</span><br><span class="line">    return CommonResult.success(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Delete-1"><a href="#Delete-1" class="headerlink" title="Delete"></a>Delete</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;批量删除退货申请&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult delete(@RequestParam(&quot;ids&quot;) List&lt;Long&gt; ids) &#123;</span><br><span class="line">    int count = returnApplyService.delete(ids);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="退货原因设置"><a href="#退货原因设置" class="headerlink" title="退货原因设置"></a>退货原因设置</h5><h6 id="Create-1"><a href="#Create-1" class="headerlink" title="Create"></a>Create</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;添加退货原因&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult create(@RequestBody OmsOrderReturnReason returnReason) &#123;</span><br><span class="line">    int count = orderReturnReasonService.create(returnReason);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Update-3"><a href="#Update-3" class="headerlink" title="Update"></a>Update</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;修改退货原因&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult update(@PathVariable Long id, @RequestBody OmsOrderReturnReason returnReason) &#123;</span><br><span class="line">    int count = orderReturnReasonService.update(id, returnReason);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;修改退货原因启用状态&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/update/status&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult updateStatus(@RequestParam(value = &quot;status&quot;) Integer status,</span><br><span class="line">                                 @RequestParam(&quot;ids&quot;) List&lt;Long&gt; ids) &#123;</span><br><span class="line">    int count = orderReturnReasonService.updateStatus(ids, status);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Read-2"><a href="#Read-2" class="headerlink" title="Read"></a>Read</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;分页查询退货原因&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult&lt;CommonPage&lt;OmsOrderReturnReason&gt;&gt; list(@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;) Integer pageSize,</span><br><span class="line">                                                           @RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;) Integer pageNum) &#123;</span><br><span class="line">    List&lt;OmsOrderReturnReason&gt; reasonList = orderReturnReasonService.list(pageSize, pageNum);</span><br><span class="line">    return CommonResult.success(CommonPage.restPage(reasonList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;获取单个退货原因详情信息&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult&lt;OmsOrderReturnReason&gt; getItem(@PathVariable Long id) &#123;</span><br><span class="line">    OmsOrderReturnReason reason = orderReturnReasonService.getItem(id);</span><br><span class="line">    return CommonResult.success(reason);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Delete-2"><a href="#Delete-2" class="headerlink" title="Delete"></a>Delete</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;批量删除退货原因&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult delete(@RequestParam(&quot;ids&quot;) List&lt;Long&gt; ids) &#123;</span><br><span class="line">    int count = orderReturnReasonService.delete(ids);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="购物车管理"><a href="#购物车管理" class="headerlink" title="购物车管理"></a>购物车管理</h3><h4 id="表格-1"><a href="#表格-1" class="headerlink" title="表格"></a>表格</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> oms_cart_item</span><br><span class="line">(</span><br><span class="line">   id                   <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">   product_id           <span class="type">bigint</span> comment <span class="string">&#x27;商品的id&#x27;</span>,</span><br><span class="line">   product_sku_id       <span class="type">bigint</span> comment <span class="string">&#x27;商品sku的id&#x27;</span>,</span><br><span class="line">   member_id            <span class="type">bigint</span> comment <span class="string">&#x27;会员id&#x27;</span>,</span><br><span class="line">   quantity             <span class="type">int</span> comment <span class="string">&#x27;购买数量&#x27;</span>,</span><br><span class="line">   price                <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) comment <span class="string">&#x27;添加到购物车的价格&#x27;</span>,</span><br><span class="line">   sp1                  <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;销售属性1&#x27;</span>,</span><br><span class="line">   sp2                  <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;销售属性2&#x27;</span>,</span><br><span class="line">   sp3                  <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;销售属性3&#x27;</span>,</span><br><span class="line">   product_pic          <span class="type">varchar</span>(<span class="number">1000</span>) comment <span class="string">&#x27;商品主图&#x27;</span>,</span><br><span class="line">   product_name         <span class="type">varchar</span>(<span class="number">500</span>) comment <span class="string">&#x27;商品名称&#x27;</span>,</span><br><span class="line">   product_brand        <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;商品品牌&#x27;</span>,</span><br><span class="line">   product_sn           <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;商品的条码&#x27;</span>,</span><br><span class="line">   product_sub_title    <span class="type">varchar</span>(<span class="number">500</span>) comment <span class="string">&#x27;商品副标题（卖点）&#x27;</span>,</span><br><span class="line">   product_sku_code     <span class="type">varchar</span>(<span class="number">200</span>) comment <span class="string">&#x27;商品sku条码&#x27;</span>,</span><br><span class="line">   member_nickname      <span class="type">varchar</span>(<span class="number">500</span>) comment <span class="string">&#x27;会员昵称&#x27;</span>,</span><br><span class="line">   create_date          datetime comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">   modify_date          datetime comment <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">   delete_status        <span class="type">int</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;是否删除&#x27;</span>,</span><br><span class="line">   product_category_id  <span class="type">bigint</span> comment <span class="string">&#x27;商品的分类&#x27;</span>,</span><br><span class="line">   product_attr         <span class="type">varchar</span>(<span class="number">500</span>) comment <span class="string">&#x27;商品销售属性:[&#123;&quot;key&quot;:&quot;颜色&quot;,&quot;value&quot;:&quot;银色&quot;&#125;,&#123;&quot;key&quot;:&quot;容量&quot;,&quot;value&quot;:&quot;4G&quot;&#125;]&#x27;</span>,</span><br><span class="line">   <span class="keyword">primary</span> key (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h4><img src="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140932747.png" alt="img" style="zoom: 80%;" />

<h4 id="前台"><a href="#前台" class="headerlink" title="前台"></a>前台</h4><p><img src="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140932252.png" alt="img" style="zoom:50%;" /><img src="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140932971.png" alt="img" style="zoom:50%;" /><img src="https://www.macrozheng.com/assets/database_screen_47.1e1c65a1.png" alt="img" style="zoom:50%;" /><img src="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140938045.png" alt="img" style="zoom:50%;" /><img src="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305140938549.png" alt="img" style="zoom:50%;" /></p>
<h4 id="业务-1"><a href="#业务-1" class="headerlink" title="业务"></a>业务</h4><h5 id="购物车Controller"><a href="#购物车Controller" class="headerlink" title="购物车Controller"></a>购物车Controller</h5><h6 id="Create-x2F-Update-添加商品"><a href="#Create-x2F-Update-添加商品" class="headerlink" title="Create &#x2F; Update 添加商品"></a>Create &#x2F; Update 添加商品</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;添加商品到购物车&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/add&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult add(@RequestBody OmsCartItem cartItem) &#123;</span><br><span class="line">    int count = cartItemService.add(cartItem);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果商品不在购物车，新增商品；如果商品在购物车中，修改数量。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public int add(OmsCartItem cartItem) &#123;</span><br><span class="line">    int count;</span><br><span class="line">    UmsMember currentMember =memberService.getCurrentMember();</span><br><span class="line">    cartItem.setMemberId(currentMember.getId());</span><br><span class="line">    cartItem.setMemberNickname(currentMember.getNickname());</span><br><span class="line">    cartItem.setDeleteStatus(0);</span><br><span class="line">    OmsCartItem existCartItem = getCartItem(cartItem);</span><br><span class="line">    if (existCartItem == null) &#123;</span><br><span class="line">        cartItem.setCreateDate(new Date());</span><br><span class="line">        count = cartItemMapper.insert(cartItem);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        cartItem.setModifyDate(new Date());</span><br><span class="line">        existCartItem.setQuantity(existCartItem.getQuantity() + cartItem.getQuantity());</span><br><span class="line">        count = cartItemMapper.updateByPrimaryKey(existCartItem);</span><br><span class="line">    &#125;</span><br><span class="line">    return count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>联表查询，要求用户Id + 商品Id + status -&gt; 获得购物车对应商品或空指针。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private OmsCartItem getCartItem(OmsCartItem cartItem) &#123;</span><br><span class="line">    OmsCartItemExample example = new OmsCartItemExample();</span><br><span class="line">    OmsCartItemExample.Criteria criteria = example.createCriteria().andMemberIdEqualTo(cartItem.getMemberId())</span><br><span class="line">            .andProductIdEqualTo(cartItem.getProductId()).andDeleteStatusEqualTo(0);</span><br><span class="line">    if (cartItem.getProductSkuId()!=null) &#123;</span><br><span class="line">        criteria.andProductSkuIdEqualTo(cartItem.getProductSkuId());</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;OmsCartItem&gt; cartItemList = cartItemMapper.selectByExample(example);</span><br><span class="line">    if (!CollectionUtils.isEmpty(cartItemList)) &#123;</span><br><span class="line">        return cartItemList.get(0);</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Update-修改购物车商品数量"><a href="#Update-修改购物车商品数量" class="headerlink" title="Update 修改购物车商品数量"></a>Update 修改购物车商品数量</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;修改购物车中指定商品的数量&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/update/quantity&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult updateQuantity(@RequestParam Long id,</span><br><span class="line">                                   @RequestParam Integer quantity) &#123;</span><br><span class="line">    int count = cartItemService.updateQuantity(id, memberService.getCurrentMember().getId(), quantity);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Read-查询购物车1"><a href="#Read-查询购物车1" class="headerlink" title="Read 查询购物车1"></a>Read 查询购物车1</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;获取当前会员的购物车列表&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult&lt;List&lt;OmsCartItem&gt;&gt; list() &#123;</span><br><span class="line">    List&lt;OmsCartItem&gt; cartItemList = cartItemService.list(memberService.getCurrentMember().getId());</span><br><span class="line">    return CommonResult.success(cartItemList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Read-查询购物车2"><a href="#Read-查询购物车2" class="headerlink" title="Read 查询购物车2"></a>Read 查询购物车2</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;获取当前会员的购物车列表,包括促销信息&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/list/promotion&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult&lt;List&lt;CartPromotionItem&gt;&gt; listPromotion(@RequestParam(required = false) List&lt;Long&gt; cartIds) &#123;</span><br><span class="line">    List&lt;CartPromotionItem&gt; cartPromotionItemList = cartItemService.listPromotion(memberService.getCurrentMember().getId(), cartIds);</span><br><span class="line">    return CommonResult.success(cartPromotionItemList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以选择查询指定商品的优惠信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public List&lt;CartPromotionItem&gt; listPromotion(Long memberId, List&lt;Long&gt; cartIds) &#123;</span><br><span class="line">    List&lt;OmsCartItem&gt; cartItemList = list(memberId);</span><br><span class="line">    if(CollUtil.isNotEmpty(cartIds))&#123;</span><br><span class="line">        cartItemList = cartItemList.stream().filter(item-&gt;cartIds.contains(item.getId())).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;CartPromotionItem&gt; cartPromotionItemList = new ArrayList&lt;&gt;();</span><br><span class="line">    if(!CollectionUtils.isEmpty(cartItemList))&#123;</span><br><span class="line">        cartPromotionItemList = promotionService.calcCartPromotion(cartItemList);</span><br><span class="line">    &#125;</span><br><span class="line">    return cartPromotionItemList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>计算优惠的方法 calCartPromotion 比较复杂，这里用图来解析。</p>
<img src="https://www.macrozheng.com/assets/database_screen_51.45f85b48.jpg" alt="img" style="zoom: 80%;" />

<h6 id="Read-获取商品规格-gt-修改"><a href="#Read-获取商品规格-gt-修改" class="headerlink" title="Read 获取商品规格 -&gt; 修改"></a>Read 获取商品规格 -&gt; 修改</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;获取购物车中指定商品的规格,用于重选规格&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/getProduct/&#123;productId&#125;&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult&lt;CartProduct&gt; getCartProduct(@PathVariable Long productId) &#123;</span><br><span class="line">    CartProduct cartProduct = cartItemService.getCartProduct(productId);</span><br><span class="line">    return CommonResult.success(cartProduct);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;修改购物车中商品的规格&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/update/attr&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult updateAttr(@RequestBody OmsCartItem cartItem) &#123;</span><br><span class="line">    int count = cartItemService.updateAttr(cartItem);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Delete-删除商品"><a href="#Delete-删除商品" class="headerlink" title="Delete 删除商品"></a>Delete 删除商品</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;删除购物车中的指定商品&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult delete(@RequestParam(&quot;ids&quot;) List&lt;Long&gt; ids) &#123;</span><br><span class="line">    int count = cartItemService.delete(memberService.getCurrentMember().getId(), ids);</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Delete-清空购物车"><a href="#Delete-清空购物车" class="headerlink" title="Delete 清空购物车"></a>Delete 清空购物车</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;清空当前会员的购物车&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/clear&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult clear() &#123;</span><br><span class="line">    int count = cartItemService.clear(memberService.getCurrentMember().getId());</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        return CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return CommonResult.failed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="订单-Controller"><a href="#订单-Controller" class="headerlink" title="订单 Controller"></a>订单 Controller</h4><h6 id="Create-确认单生成"><a href="#Create-确认单生成" class="headerlink" title="Create 确认单生成"></a>Create 确认单生成</h6><p>购物车下单 -&gt; 选择收货地址&#x2F;查看总金额&#x2F;…。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;根据购物车信息生成确认单&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/generateConfirmOrder&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult&lt;ConfirmOrderResult&gt; generateConfirmOrder(@RequestBody List&lt;Long&gt; cartIds) &#123;</span><br><span class="line">    ConfirmOrderResult confirmOrderResult = portalOrderService.generateConfirmOrder(cartIds);</span><br><span class="line">    return CommonResult.success(confirmOrderResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>确认单需要确认的信息列表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public class ConfirmOrderResult &#123;</span><br><span class="line">    @ApiModelProperty(&quot;包含优惠信息的购物车信息&quot;)</span><br><span class="line">    private List&lt;CartPromotionItem&gt; cartPromotionItemList;</span><br><span class="line">    @ApiModelProperty(&quot;用户收货地址列表&quot;)</span><br><span class="line">    private List&lt;UmsMemberReceiveAddress&gt; memberReceiveAddressList;</span><br><span class="line">    @ApiModelProperty(&quot;用户可用优惠券列表&quot;)</span><br><span class="line">    private List&lt;SmsCouponHistoryDetail&gt; couponHistoryDetailList;</span><br><span class="line">    @ApiModelProperty(&quot;积分使用规则&quot;)</span><br><span class="line">    private UmsIntegrationConsumeSetting integrationConsumeSetting;</span><br><span class="line">    @ApiModelProperty(&quot;会员持有的积分&quot;)</span><br><span class="line">    private Integer memberIntegration;</span><br><span class="line">    @ApiModelProperty(&quot;计算的金额&quot;)</span><br><span class="line">    private CalcAmount calcAmount;</span><br><span class="line"></span><br><span class="line">    @Getter</span><br><span class="line">    @Setter</span><br><span class="line">    public static class CalcAmount&#123;</span><br><span class="line">        @ApiModelProperty(&quot;订单商品总金额&quot;)</span><br><span class="line">        private BigDecimal totalAmount;</span><br><span class="line">        @ApiModelProperty(&quot;运费&quot;)</span><br><span class="line">        private BigDecimal freightAmount;</span><br><span class="line">        @ApiModelProperty(&quot;活动优惠&quot;)</span><br><span class="line">        private BigDecimal promotionAmount;</span><br><span class="line">        @ApiModelProperty(&quot;应付金额&quot;)</span><br><span class="line">        private BigDecimal payAmount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/moonlightqz/PicGo/raw/master/img/202305141042159.jpg" alt="img" style="zoom:67%;" />

<h6 id="Create-生成订单"><a href="#Create-生成订单" class="headerlink" title="Create 生成订单"></a>Create 生成订单</h6><p>生成订单时，检查一些需要使用&#x2F;扣除的东西（商品库存、优惠券、积分）</p>
<p>（在实际应用中，下确认单时就已经锁定了库存，扣除了优惠券和积分，生成待支付订单）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;根据购物车信息生成订单&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/generateOrder&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult generateOrder(@RequestBody OrderParam orderParam) &#123;</span><br><span class="line">    Map&lt;String, Object&gt; result = portalOrderService.generateOrder(orderParam);</span><br><span class="line">    return CommonResult.success(result, &quot;下单成功&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="支付成功"><a href="#支付成功" class="headerlink" title="支付成功"></a>支付成功</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;用户支付成功的回调&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/paySuccess&quot;, method = RequestMethod.POST)</span><br><span class="line">@ResponseBody</span><br><span class="line">public CommonResult paySuccess(@RequestParam Long orderId,@RequestParam Integer payType) &#123;</span><br><span class="line">    Integer count = portalOrderService.paySuccess(orderId,payType);</span><br><span class="line">    return CommonResult.success(count, &quot;支付成功&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="取消超时订单"><a href="#取消超时订单" class="headerlink" title="取消超时订单"></a>取消超时订单</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;自动取消超时订单&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/cancelTimeOutOrder&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">cancelTimeOutOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    portalOrderService.cancelTimeOutOrder();</span><br><span class="line">    <span class="keyword">return</span> CommonResult.success(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>Mall 订单模块分析</p><p><a href="http://example.com/2023/05/13/Mall-订单模块分析/">http://example.com/2023/05/13/Mall-订单模块分析/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>MoonlightQz</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2023-05-13</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-05-24</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>Afdian.net</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/05/14/Leetcode-%E5%93%88%E5%B8%8C%E8%A1%A8/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Leetcode 哈希表</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/05/13/Mall-%E5%95%86%E5%93%81%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90/"><span class="level-item">Mall 商品模块分析</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="MoonlightQz"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">MoonlightQz</p><p class="is-size-6 is-block">postgraduate student</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shenzhen, Guangdong Province</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">21</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">3</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-24T01:49:15.000Z">2023-05-24</time></p><p class="title"><a href="/2023/05/24/Leetcode-%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/">Leetcode 回溯算法</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-23T12:29:10.000Z">2023-05-23</time></p><p class="title"><a href="/2023/05/23/Leetcode-%E6%A0%88%E4%B8%8E%E9%98%9F%E5%88%97/">Leetcode 栈与队列</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-23T08:54:26.000Z">2023-05-23</time></p><p class="title"><a href="/2023/05/23/Leetcode-%E9%93%BE%E8%A1%A8/">Leetcode 链表</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-23T06:45:44.000Z">2023-05-23</time></p><p class="title"><a href="/2023/05/23/Leetcode-%E6%95%B0%E7%BB%84/">Leetcode 数组</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-23T06:39:39.000Z">2023-05-23</time></p><p class="title"><a href="/2023/05/23/Leetcode-DP-%E6%80%BB%E7%BB%93/">Leetcode DP 总结</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Leetcode/"><span class="tag">Leetcode</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mall/"><span class="tag">Mall</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring-Boot/"><span class="tag">Spring Boot</span><span class="tag">4</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a><p class="is-size-7"><span>&copy; 2023 MoonlightQz</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>